# 【Web開発100本ノック】


以下テーマ6の解答

## 課題61. セッションとクッキーの仕組み


## 61. セッションとクッキーの仕組み

HTTPは本来「ステートレス（状態を保持しない）」なプロトコルであるため、ログイン状態などを維持するためにクッキー（Cookie）とセッション（Session）という仕組みを組み合わせて利用する。

---

### 1. クッキーとセッションの比較

| 項目 | クッキー (Cookie) | セッション (Session) |
| :--- | :--- | :--- |
| **保存場所** | **クライアント側**（ブラウザ） | **サーバー側** |
| **データの実体** | ブラウザ内のテキストファイル | サーバーのメモリやデータベース |
| **主な用途** | セッションIDの保持、設定保存 | ログイン状態、ユーザー情報の保持 |
| **安全性** | ユーザーが中身を見れるため低い | サーバー管理のため比較的高い |

---

### 2. Webサービスにおける仕組みと役割

ログイン機能を例とした、一般的な動作フローは以下の通り。

1. **セッションの生成**: ユーザーがログインに成功すると、サーバー側で一意の**「セッションID」**を生成し、サーバー内にデータを保存。
2. **IDの付与（Set-Cookie）**: サーバーはレスポンスのヘッダーを使用して、ブラウザにセッションIDを「クッキー」として保存するよう指示。
3. **IDの自動送信**: 以降、ブラウザは同じドメインへのリクエストの際、自動的にクッキー（セッションID）をヘッダーに含めて送信。
4. **ユーザーの識別**: サーバーは送られてきたセッションIDを元に、サーバー内のデータと照合し「誰がアクセスしているか」を判断。

### 3. セキュリティ上の注意点

* **セッションハイジャック**: セッションIDが盗まれると、第三者が本人になりすますことができてしまう。
* **対策**: 
    * **HTTPS化**: 通信を暗号化し、IDの盗聴を防ぐ。
    * **HttpOnly属性**: JavaScriptからクッキーを読み取れないようにし、XSS攻撃を防ぐ。
    * **Secure属性**: HTTPS通信時のみクッキーを送信するように制限する。

---

### 参考サイト

1. **MDN Web Docs - HTTP クッキー** [https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies](https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies)  
   (クッキーの基本的な仕組み、属性、セキュリティについての公式リファレンス)
2. **国民のための情報セキュリティサイト（総務省） - クッキー（Cookie）の仕組み** [https://www.soumu.go.jp/main_sosiki/cybersecurity/kokumin/basic/basic_service_06.html](https://www.soumu.go.jp/main_sosiki/cybersecurity/kokumin/basic/basic_service_06.html)  
   (初心者向けにクッキーの役割とプライバシーについて解説されている公的な資料)
